---
import { Image } from 'astro:assets'
const base = import.meta.env.BASE_URL;
const { project } = Astro.props;
const slug = project.id.replace(/\.md$/, '');

//actually the biggest bullshit I've ever seen
const cleanBase = base.endsWith('/') ? base : `${base}/`;
const projectLink = `${cleanBase}projects/${slug}`;
---

<a  href={projectLink}
    class="group block bg-steam-gray/50 hover:bg-steam-gray transition-all duration-300">
    <div class="relative group-hover:scale-105 transition-transform duration-300 drop-shadow-2xl aspect-video">
        <Image 
          src={project.data.thumbnail} 
          alt={project.data.title} 
          class="object-cover w-full h-full bg-steam-dark2"
        />

        <div class="p-4 border-b-2 border-transparent group-hover:border-steam-blue bg-linear-to-b from-steam-dark to-steam-dark2">
            <h3 class="text-white font-bold uppercase tracking-tight">{project.data.title}</h3>
            <div class="flex gap-2 mt-2">
              {project.data.tags.map((tag: string) => (
                <span class="text-[10px] mt-auto mb-auto bg-black/40 px-2 py-0.5 text-steam-accent">{tag}</span>
              ))}
              <p class="text-white font-bold ml-auto mt-auto mb-auto">{project.data.version}</h3>
            </div>  
        </div> 

        <div class="absolute inset-0 shadow-[inset_0_0_30px_rgba(102,192,244,0)] group-hover:shadow-[inset_0_0_30px_rgba(102,192,244,0.2)] transition-shadow"></div>
        <div class="pointer-events-none absolute inset-0 shadow-[0_10px_28px_-4px_rgba(0,0,0,0.2)] group-hover:shadow-[0_10px_28px_-4px_rgba(0,0,0,0.6)] transition-shadow"></div>
    </div>
</a>

<script>
    const cards = document.querySelectorAll<HTMLElement>('.tilt-card');

    cards.forEach((card) => {
        card.addEventListener('mousemove', (e: Event) => {
            const mouseEvent = e as MouseEvent;
            const rect = card.getBoundingClientRect();
            const x = mouseEvent.clientX - rect.left;
            const y = mouseEvent.clientY - rect.right;

            const centerX = rect.width / 2;
            const centerY = rect.height / 2;

            const rotateY = ((y - centerY) / centerY) * -5;
            const rotateX = ((x - centerX) / centerX) * 5;

            card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.05, 1.05, 1.05)`;
        })

        card.addEventListener('mouseleave', () => {
            card.style.transform = `perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)`;
        });
    });
</script>

<style>
    .perspective-1000{
        perspective: 1000px;
    }
</style>